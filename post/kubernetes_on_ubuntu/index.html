<!DOCTYPE html>
<html lang="en-us">
<head><script src="/pinchofcode/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=pinchofcode/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='http://localhost:1313/pinchofcode/js/theme-mode.js'></script>
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/frameworks.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/github.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/github-style.css' />
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/light.css' />
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/dark.css' />
    <link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/syntax.css' />
    <title>Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ - Pinch of Code</title>
    
    <link rel="icon" type="image/x-icon" href='/pinchofcode/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ Kubernetes has become the de facto standard for container orchestration, enabling organizations to deploy, scale, and manage containerized applications with ease. In this guide, we&amp;rsquo;ll walk through the process of installing Kubernetes on Ubuntu, one of the most popular Linux distributions.
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/pinchofcode/post/kubernetes_on_ubuntu/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ - Pinch of Code" />
<meta name="twitter:description"
  content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ Kubernetes has become the de facto standard for container orchestration, enabling organizations to deploy, scale, and manage containerized applications with ease. In this guide, we&amp;rsquo;ll walk through the process of installing Kubernetes on Ubuntu, one of the most popular Linux distributions.
" />
<meta name="twitter:site" content="http://localhost:1313/pinchofcode/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="http://localhost:1313/pinchofcode/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ - Pinch of Code">
<meta property="og:description"
  content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³ Kubernetes has become the de facto standard for container orchestration, enabling organizations to deploy, scale, and manage containerized applications with ease. In this guide, we&amp;rsquo;ll walk through the process of installing Kubernetes on Ubuntu, one of the most popular Linux distributions.
" />
<meta property="og:url" content="http://localhost:1313/pinchofcode/post/kubernetes_on_ubuntu/" />
<meta property="og:site_name" content="Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³" />
<meta property="og:image"
  content="http://localhost:1313/pinchofcode/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2024-03-12 17:23:31 &#43;0530 IST" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="http://localhost:1313/pinchofcode/">
        <img class="octicon" height="32" width="32" src="/pinchofcode/images/GitHub-Mark-Light-32px.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <img height="24" class="octicon octicon-three-bars" width="24" src="/pinchofcode/images/GitHub-Mark-Light-32px.png">
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:http://localhost:1313/pinchofcode/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="http://localhost:1313/pinchofcode/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/pinchofcode/images/GitHub-Mark-Light-32px.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="http://localhost:1313/pinchofcode/">
                  <img class=" avatar-user"
                    src="/pinchofcode/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="http://localhost:1313/pinchofcode/">Krishna Kalesh</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="http://localhost:1313/pinchofcode/post/kubernetes_on_ubuntu/">Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 12 Mar 2024 17:23:31 &#43;0530"
                    class="no-wrap">
                    Tue, 12 Mar 2024 17:23:31 &#43;0530</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Wed, 13 Mar 2024 11:03:59 &#43;0530"
                    class="no-wrap">
                    Wed, 13 Mar 2024 11:03:59 &#43;0530</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      913 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="installing-kubernetes-on-ubuntu-a-step-by-step-guide-">Installing Kubernetes on Ubuntu: A Step-by-Step Guide ðŸ›³</h1>
<p>Kubernetes has become the de facto standard for container orchestration, enabling organizations to deploy, scale, and manage containerized applications with ease. In this guide, we&rsquo;ll walk through the process of installing Kubernetes on Ubuntu, one of the most popular Linux distributions.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before we begin, ensure that you have the following prerequisites:</p>
<ol>
<li>Ubuntu Linux distribution (version 18.04 or later recommended) This Example use - UBUNTU 22.04</li>
<li>A minimum of 2GB of RAM per node (4GB or more recommended)</li>
<li>A reliable internet connection</li>
</ol>
<h2 id="set-up-hostnames">Set up hostnames</h2>
<p>Run below scripts as root user</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo hostnamectl set-hostname <span class="s2">&#34;k8s-appmaster.xyzcorp&#34;</span>
</span></span></code></pre></div><p>Add below line to /etc/hosts</p>
<pre><code>{VM 1 IP 1} k8s-worker1.xyzcorp
{VM 2 IP 1} k8s-appmaster.xyzcorp
</code></pre>
<p>In worker nodes do same as below,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo hostnamectl set-hostname <span class="s2">&#34;k8s-worker1.xyzcorp&#34;</span>
</span></span></code></pre></div><h2 id="below-steps-to-enable-some-network-support-for-kubernetes">Below steps to enable some network support for Kubernetes.</h2>
<p>Run below scripts as root user</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#Kernel module Overlays </span>
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;overlay\nbr_netfilter\n&#34;</span> &gt;&gt; /etc/modules-load.d/containerd.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo modprobe overlay
</span></span><span class="line"><span class="cl">sudo modprobe br_netfilter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#IP Table Configurations </span>
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;net.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\n&#34;</span> &gt;&gt; /etc/sysctl.d/99-kubernetes-cri.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sysctl --system
</span></span></code></pre></div><h2 id="install-container-run-time">Install Container run time.</h2>
<p>Kubernetes prefer containerd. so used that instead of Docker.</p>
<p>Run below scripts as root user</p>
<p>Here, we download the containerd tar.gz and enable containerd as a service.
Also, setting default configuration for containerd as well.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://github.com/containerd/containerd/releases/download/v1.6.16/containerd-1.6.16-linux-amd64.tar.gz -P /tmp/
</span></span><span class="line"><span class="cl">tar Cxzvf /usr/local /tmp/containerd-1.6.16-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service -P /etc/systemd/system/
</span></span><span class="line"><span class="cl">systemctl daemon-reload
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> --now containerd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64 -P /tmp/
</span></span><span class="line"><span class="cl">install -m <span class="m">755</span> /tmp/runc.amd64 /usr/local/sbin/runc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget https://github.com/containernetworking/plugins/releases/download/v1.2.0/cni-plugins-linux-amd64-v1.2.0.tgz -P /tmp/
</span></span><span class="line"><span class="cl">mkdir -p /opt/cni/bin
</span></span><span class="line"><span class="cl">tar Cxzvf /opt/cni/bin /tmp/cni-plugins-linux-amd64-v1.2.0.tgz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mkdir -p /etc/containerd
</span></span><span class="line"><span class="cl">containerd config default <span class="p">|</span> tee /etc/containerd/config.toml   <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="s">&lt;&lt; manually edit and change system</span>dCgroup to <span class="nb">true</span>
</span></span><span class="line"><span class="cl">systemctl restart containerd
</span></span></code></pre></div><h2 id="make-swap-memory-off">Make Swap memory OFF</h2>
<p>Run below scripts as root user</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo -i
</span></span><span class="line"><span class="cl">swapoff -a
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>	
</span></span><span class="line"><span class="cl">free -h
</span></span><span class="line"><span class="cl"><span class="c1">#(swapoff -a  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;  disable it in /etc/fstab instead by commenting out the line mentioned swap)</span>
</span></span></code></pre></div><h2 id="download-kubernetes-components">Download Kubernetes components.</h2>
<p>Run below scripts as root user</p>
<p>Download Kubernetes repository and reboot the VM</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">    apt-get update
</span></span><span class="line"><span class="cl">	apt-get install -y apt-transport-https ca-certificates curl
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	*curl -fsSLo /etc/apt/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
</span></span><span class="line"><span class="cl">	*echo <span class="s2">&#34;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    apt-get update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    reboot
</span></span></code></pre></div><h2 id="install-kubernetes-binaries-kubelet-kubeadmkubectl-">Install Kubernetes binaries (kubelet, kubeadm,kubectl ).</h2>
<p>Run below scripts as root user</p>
<p>It is better to control the version manually and mark hold of the version.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#select version manually </span>
</span></span><span class="line"><span class="cl">	apt-get install -y <span class="nv">kubelet</span><span class="o">=</span>1.26.9-00 <span class="nv">kubeadm</span><span class="o">=</span>1.26.9-00 <span class="nv">kubectl</span><span class="o">=</span>1.26.9-00
</span></span><span class="line"><span class="cl">	apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></div><h2 id="all-the-above-steps-we-need-to-do-in-master-as-well-as-worker-nodes">All the above steps we need to do in master as well as worker nodes.</h2>
<h2 id="master-node-only---initialize-kubeadm">Master Node Only - Initialize kubeadm</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo kubeadm init --pod-network-cidr 10.10.0.0/16 --kubernetes-version 1.26.9 --node-name k8s-appmaster.xyzcorp
</span></span></code></pre></div><p>Now exit from root user mode and login as normal user to VM and execute below commands</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">	mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">	sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">	sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config	
</span></span></code></pre></div><p>Installation can be verified using commands</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">	<span class="nv">$kubectl</span> cluster-info
</span></span><span class="line"><span class="cl">	<span class="nv">$kubectl</span> get nodes
</span></span><span class="line"><span class="cl">	<span class="nv">$kubectl</span> get namespaces
</span></span><span class="line"><span class="cl">	<span class="nv">$kubectl</span> get pods -n kube-system
</span></span></code></pre></div><h2 id="master-node-only---add-cni-plugin">Master Node Only - Add CNI plugin</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/tigera-operator.yaml
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/custom-resources.yaml
</span></span><span class="line"><span class="cl">vi custom-resources.yaml <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;</span> edit the CIDR <span class="k">for</span> pods as it<span class="err">&#39;</span>s custom - 10.10.0.0/16
</span></span><span class="line"><span class="cl">kubectl apply -f custom-resources.yaml
</span></span></code></pre></div><p>Refer : <a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart">https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart</a></p>
<h2 id="remove-the-taints-on-the-master-node">Remove the taints on the master node</h2>
<p>Remove the taints on the master node so that you can schedule pods on it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">	kubectl taint nodes --all node-role.kubernetes.io/control-plane-
</span></span><span class="line"><span class="cl">	kubectl taint nodes --all node-role.kubernetes.io/master-
</span></span></code></pre></div><h2 id="generate-token-for-worker-nodes">Generate token for worker nodes</h2>
<p>When we execute below command in master node, it will give us the discovery token that
can be used by worker nodes to join control-plane.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubeadm token create --print-join-command
</span></span></code></pre></div><h2 id="for-worker-nodes-to-join-master">For worker nodes to join master</h2>
<p>Use the command received from above step from worker node and then worker will
automatically join the cluster.</p>
<p><img src="/pinchofcode/images/k81.png" alt="Alt text"></p>
<h2 id="common-issues">Common Issues</h2>
<p><strong>Below steps can be used to reset and install Kubernetes again</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get pods --all-namespaces
</span></span><span class="line"><span class="cl">sudo systemctl disable kubelet
</span></span><span class="line"><span class="cl">sudo systemctl stop kubelet  
</span></span><span class="line"><span class="cl">sudo systemctl stop kube-proxy
</span></span><span class="line"><span class="cl">sudo systemctl stop containerd
</span></span><span class="line"><span class="cl">sudo systemctl status containerd 
</span></span><span class="line"><span class="cl">kubectl delete configmap -n kube-system calico-config
</span></span><span class="line"><span class="cl">kubectl delete networkpolicy --all -n kube-system  
</span></span><span class="line"><span class="cl">sudo kubeadm reset -f  
</span></span><span class="line"><span class="cl">sudo rm -rf /usr/bin/kubelet /usr/bin/kubeadm /usr/bin/kubectl  
</span></span><span class="line"><span class="cl">sudo rm -rf /etc/kubernetes/
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/kubelet/
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/kube-proxy/
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/kubelet/
</span></span><span class="line"><span class="cl">sudo rm -rf /opt/cni/bin/calico*
</span></span><span class="line"><span class="cl">sudo rm -rf /etc/cni/net.d/10-calico.conflist
</span></span><span class="line"><span class="cl">sudo rm -rf /etc/cni/net.d/calico-kubeconfig
</span></span><span class="line"><span class="cl">sudo rm -rf /home/<span class="o">{</span>USER_YOURS<span class="o">}</span>/.kube/
</span></span><span class="line"><span class="cl">sudo rm -rf /etc/systemd/system/kubelet.service.d
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/etcd
</span></span><span class="line"><span class="cl">sudo rm -rf /var/log/kubernetes/
</span></span><span class="line"><span class="cl">sudo rm -rf /var/log/kube-proxy/
</span></span><span class="line"><span class="cl">sudo rm -f /etc/cni/net.d/calico-*
</span></span><span class="line"><span class="cl">sudo apt-get purge kubeadm kubectl kubelet kubernetes-cni 
</span></span><span class="line"><span class="cl">sudo apt-get autoremove  
</span></span><span class="line"><span class="cl">sudo journalctl --vacuum-time<span class="o">=</span>1d  
</span></span><span class="line"><span class="cl">sudo reboot 
</span></span></code></pre></div><p>Once everything removed to re apply, we need to repeat steps from
kubernetes installation to reinstate Kubernetes setup.</p>
<p><strong>Below steps can be used to remove a worker node from cluster</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  kubectl drain k8s-worker1.xyzcorp --ignore-daemonsets
</span></span><span class="line"><span class="cl">  kubectl delete node k8s-worker1.xyzcorp
</span></span></code></pre></div><p><strong>Below steps can be used to reset kubeadm</strong></p>
<p>Once everything removed to re apply, we need to repeat steps from
kubernetes installation to reinstate Kubernetes setup.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl stop kubelet
</span></span><span class="line"><span class="cl">sudo kubeadm reset
</span></span><span class="line"><span class="cl">sudo apt remove -y kubectl kubelet kubeadm
</span></span><span class="line"><span class="cl">sudo apt autoremove -y
</span></span><span class="line"><span class="cl">sudo reboot
</span></span><span class="line"><span class="cl">chekc <span class="k">if</span> any process running
</span></span><span class="line"><span class="cl">ps aux <span class="p">|</span> grep kube-
</span></span></code></pre></div><p><strong>Complete removal of containerd</strong></p>
<p>Once everything removed to re apply, we need to repeat steps from
kubernetes installation to reinstate Kubernetes setup.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl disable containerd
</span></span><span class="line"><span class="cl">sudo apt-get remove containerd.io
</span></span><span class="line"><span class="cl">sudo apt autoremove
</span></span><span class="line"><span class="cl">sudo apt-get purge containerd.io
</span></span><span class="line"><span class="cl">sudo rm -rf /etc/containerd
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/containerd
</span></span><span class="line"><span class="cl">sudo apt autoremove
</span></span><span class="line"><span class="cl">sudo apt-get clean
</span></span><span class="line"><span class="cl">dpkg -l <span class="p">|</span> grep containerd
</span></span><span class="line"><span class="cl">sudo dpkg --purge containerd
</span></span><span class="line"><span class="cl">sudo apt autoremove
</span></span></code></pre></div><p><strong>Some helpful scripts for installation verifications</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get pod -n tigera-operator <span class="p">|</span> grep Error <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">|</span> xargs kubectl delete pod -n tigera-operator --&gt;&gt;&gt;&gt;&gt; to remove tigera-operator
</span></span><span class="line"><span class="cl">kubectl cluster-info
</span></span><span class="line"><span class="cl">kubectl get nodes
</span></span><span class="line"><span class="cl">kubectl get namespaces
</span></span><span class="line"><span class="cl">kubectl get pods -n kube-system
</span></span><span class="line"><span class="cl">kubectl get pods --all-namespaces
</span></span></code></pre></div></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='http://localhost:1313/pinchofcode/js/toc.js'></script>
<link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='http://localhost:1313/pinchofcode/css/gitalk.css'>
<script src='http://localhost:1313/pinchofcode/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: '1797648028c1f1a543f9',
    clientSecret: '39589f861950278dc7d6b2fb66ceccf346009a96',
    repo: 'pinchofcode',
    owner: 'krishnakalesh',
    admin: ['krishnakalesh'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="http://localhost:1313/pinchofcode/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="http://localhost:1313/pinchofcode/js/github-style.js"></script>




</html>